---
title: "Лабораторная работа №3"
author: "Марковский Валентин Александрович"
date: "25 12 2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

``` {r, include = FALSE}
library('knitr')  # Пакет для генерации отчёта
library('lmtest') # Пакет для теста Бройша-Пагана и Голдфельда-Квандта
library('broom')  # Транасформация данных
library('sandwich')
# Загрузка объектов из сохраненного рабочего пространства
load('R_Dannye_Markovskiy.RData')
attach(reg.df)
# Определение числа показателей
L.reg.df <- length(reg.df)-1
```

## Лучшие модели

1. $Y = 1001100 + 1149000 \cdot foУФО - 11,65 \cdot X4 + 23 \cdot foЦФО.X4$ ($R^2_{adj} = 0,3523$)
2. $Y = 9.9697 - 24.68 \cdot foПФО - 2.55 \cdot foСКФО - 4.855 \cdot foСФО + 2.13 \cdot foУФО - 11.32 \cdot foЦФО +2.83 \cdot X4.foПФО + 0.72 \cdot X4.foСФО + 1.13 \cdot X4.foЦФО$ ($R^2_{adj} = 0,4268$)

## Список столбцов файла:
* ```fo``` - название федерального округа
* ```iso_code``` - код региона субъекта РФ
* ```region``` - название субъекта РФ
* ```Y``` - Объем отгруженных товаров собственного производства, выполненных работ и услуг собственными силами по видам экономической деятельности: обрабатывающие производства за 2014 год
* ```X1``` - Индексы цен производителей промышленных товаров по видам экономической деятельности: обрабатывающие производства за 2014 год
* ```X2``` - Изменение среднегодовой численности занятых за 2014 год
* ```X3``` - Индекс физического объема ВРП за 2013 год
* ```X4``` - Сумма убытка организаций по отдельным видам экономической деятельности: обрабатывающие производства за 2013 год

Данные по пяти показателям по обрабатывающим производствам за 2013-2014 гг. по регионам РФ. Данные собраны из файлов, загруженных из базы Росстата [https://www.gks.ru/folder/210/document/13204](https://www.gks.ru/folder/210/document/13204) 25 декабря 2020 года.
После загрузки файлы, каждый за отдельный год, были объединены в одну таблицу. Пропущенные наблюдения обозначить как NA.

## График остатков "Residuals vs Fitted" для моделей
``` {r, echo=FALSE}
# Вывод графика остатков для всех моделей
plot(fit.X4.fo, 1, main = 'Модель c исходными данными (с фиктивными переменными)')
plot(fit.log.X4.fo, 1, main = 'Модель c логарифмами (с фиктивными переменными)')
```

## Тест на равенство среднего остатков нулю
``` {r, echo = FALSE}
# Список построенных моделей 
models.list <- list(fit.X4.fo, fit.log.X4.fo) 
names(models.list) <- c('fit.X4.fo', 'fit.log.X4.fo')
#Создаем фрейм под характеристики двух моделей на тест на среднего остатков нулю
Means <- data.frame(Модель = names(models.list),
                                       Статистика = rep(0, length(models.list)),
                                       P.значение = rep(0, length(models.list)))
for(i in 1:length(models.list)){
    Means[i, 'Статистика'] <-                    
    t.test(models.list[[i]]$residuals, mu = 0, alternative = 'two.sided')$statistic
    Means[i, 'P.значение'] <-                    
    t.test(models.list[[i]]$residuals, mu = 0, alternative = 'two.sided')$p.value
}
kable(Means)
```

## Вывод
Для обеих моделей принимается нулевая гипотеза (среднее значение остатков равно 0), так как p-значения моделей (1) больше заданного уровня значимости 0,05.

## Тест Бройша-Пагана на гетероскедастичность
``` {r, echo = FALSE}
#Создаем фрейм под характеристики двух моделей на тест Б-П
BP_test <- data.frame(Модель = names(models.list),
                            Статистика = rep(0, length(models.list)),
                            P.значение = rep(0, length(models.list)))
for(i in 1:length(models.list)){
    BP_test[i, 'Статистика'] <- 
        round(bptest(models.list[[i]])$statistic, 3)
    BP_test[i, 'P.значение'] <- 
        round(bptest(models.list[[i]])$p.value, 3)
}
kable(BP_test)
```

## Вывод
Для первой модели нулевая гипотеза отвергается, т.е. остатки являются гетероскедастичными, поскольку p-значение = 0.000 меньше заданного уровня значимости 0.05. Для второй модели нулевая гипотеза принимается, т.е. остатки не являются гетероскедастичными, поскольку p-значение = 0.449 больше заданного уровня значимости.

## Тест Голдфельда-Квандта на гетероскедастичность
``` {r, echo=FALSE}
# Вспомогательный фрейм h
for(i in 1:length(models.list)){h <- augment(models.list[[i]],reg.df)}
#Создаем фрейм под характеристики двух моделей на тест Г-К
GQ_test <- data.frame(Модель = names(models.list),
                                       Статистика = rep(0, length(models.list)),
                                       P.значение = rep(0, length(models.list)))
for(i in 1:length(models.list)){
    GQ_test[i, 'Статистика'] <-                    
    round(gqtest(models.list[[i]], order.by = X1 + X2, data = h, fraction = 0.2)$statistic, 3)
    GQ_test[i, 'P.значение'] <-                    
    round(gqtest(models.list[[i]], order.by = X1 + X2, data = h, fraction = 0.2)$p.value, 3)
}
#Таблица с нужными нам характеристиками
kable(GQ_test)
```

## Вывод
Для первой модели нулевая гипотеза отвергается, т.е. остатки являются гетероскедастичными, поскольку p-значение = 0.000 меньше заданного уровня значимости 0.05. Для второй модели нулевая гипотеза принимается, т.е. остатки не являются гетероскедастичными, поскольку p-значение = 0.255 больше заданного уровня значимости.

## Тест Дабрина-Уотсона на автокрреляцию
``` {r, echo=FALSE}
DW_test <- data.frame(Модель = names(models.list),
                                       Статистика = rep(0, length(models.list)),
                                       P.значение = rep(0, length(models.list)))
for(i in 1:length(models.list)){
    DW_test[i, 'Статистика'] <-                    
    round(dwtest(models.list[[i]], alternative = 'two.sided')$statistic, 3)
    DW_test[i, 'P.значение'] <-                    
    round(dwtest(models.list[[i]], alternative = 'two.sided')$p.value, 3)
}
#Таблица с нужными нам характеристиками
kable(DW_test)
```

## Вывод
Для обеех моделей нулевая гипотеза принимается, т.е. коэффициент автокорреляции незначим, поскольку p-значение (0.051 и 0.170 соответственно) больше заданного уровня значимости 0.05.
Так как условия Гаусса-Маркова не выполнены ни для одной модели (по тесту Бройша-Пагана и Голдфельда-Квандта), то возьмём лучшее уравнение регрессии fit.log.X4.fo (скорректированный R-квадрат = 0,4264) и переоценим его параметры с учётом ошибок спецификации.

## Переоценка коэффициентов регрессии
``` {r, echo = FALSE}
# Переоценка коэффициентов регрессии
coeftest(models.list[[2]], vcov. = vcovHAC(models.list[[2]]))
```

## Вывод
После переоценки лучшей модели все параметры остались значимыми.