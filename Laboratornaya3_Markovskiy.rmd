---
title: "Лабораторная 3"
author: "Марковский В.А."
date: "23 12 2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


``` {r, include = FALSE}
library('knitr') # Пакет для генерации отчёта
library('lmtest') # Пакет для теста Бройша-Пагана и Голдфельда-Квандта
library('broom') # Транасформация данных
library('sandwich')
# Загрузка объектов из сохраненного рабочего пространства
load('Markovskiy_Data.RData')
attach(reg.df)
# Определение числа показателей
L.reg.df <- length(reg.df)-1
```

## Список столбцов файла:
* ```fo``` - федеральный округ, в котором располагается исследуемый субъект РФ;
* ```region``` - название субъкта РФ;
* ```Y``` - Объем отгруженных товаров собственного производства, выполненных работ и услуг собственными силами по видам экономической деятельности: обрабатывающие производства за 2014 год, млн. руб
* ```X1``` - Индексы цен производителей промышленных товаров по видам экономической деятельности: обрабатывающие производства за 2014 год, в % (декабрь к декабрю предыдущего года)
* ```X2``` -  Изменение среднегодовой численности занятых за 2014 год, в % к предыдущему году
* ```X3``` - Индекс физического объема ВРП за 2013 год, в постоянных ценах в % к предыдущему году
* ```X4``` - Сумма убытка организаций по отдельным видам экономической деятельности: обрабатывающие производства за 2013 год, млн руб

Данные по пяти показателям по обрабатывающим производствам за 2013-2014 гг. по регионам РФ (`r length(reg.df$Y)` наблюдения). Данные собраны из файлов, загруженных из базы Росстата [https://www.gks.ru/folder/210/document/13204](https://www.gks.ru/folder/210/document/13204) 19 октября 2019 года.
После загрузки файлы, каждый за отдельный год, были объединены в одну таблицу. Пропущенные наблюдения обозначить как NA.

*Примечание.* В указанный период респубика Крым и г.Севастополь не были включены в состав РФ, поэтому показатели по данным регионам не рассчитывались.

## График остатков "Residuals vs Fitted" для моделей
``` {r, echo=FALSE}
# Вывод графика остатков для всех моделей
plot(fit.X4, 1, main = 'Model without dummy variables')
plot(fit.X4.fo, 1, main = 'Model with dummy variables')
```

## Тест на равенство среднего остатков нулю
``` {r, echo=FALSE}
# Список построенных моделей 
models.list <- list(fit.X4, fit.X4.fo) 
names(models.list) <- c('fit.X4', 'fit.X4.fo') 
#Создаем фрейм под характеристики двух моделей на тест на среднего остатков нулю
MU_test <- data.frame(Model = names(models.list),
                                       Statistic = rep(0, length(models.list)),
                                       P.value = rep(0, length(models.list)))
for(i in 1:length(models.list)){
    MU_test[i, 'Statistic'] <-                    
    round(t.test(models.list[[i]]$residuals, mu = 0, alternative = 'two.sided')$statistic, 3)
    MU_test[i, 'P.value'] <-                    
    round(t.test(models.list[[i]]$residuals, mu = 0, alternative = 'two.sided')$p.value, 3)
}
#Таблица с нужными нам характеристиками
kable(MU_test)
```

## Вывод
Для обеих моделей принимается нулевая гипотеза (среднее значение остатков равно 0), так как p-значения моделей (1) больше заданного уровня значимости 0,05.


## Тест Бройша-Пагана на гетероскедастичность
``` {r, echo = FALSE}
#Создаем фрейм под характеристики двух моделей на тест Б-П
BP_test <- data.frame(Model = names(models.list),
                            Statistic = rep(0, length(models.list)),
                            P.value = rep(0, length(models.list)))
for(i in 1:length(models.list)){
    BP_test[i, 'Statistic'] <- 
        round(bptest(models.list[[i]])$statistic, 3)
    BP_test[i, 'P.value'] <- 
        round(bptest(models.list[[i]])$p.value, 3)
}
kable(BP_test)
```

## Вывод
Для обеех моделей нулевая гипотеза отвергается, т.е. остатки являются гетероскедостичными, так как p-значения моделей (0.000 и 0.003 соответсвенно) меньше заданного уровня значимости 0.05.   

## Тест Голдфельда-Квандта на гетероскедастичность
``` {r, echo=FALSE}
#Создаем фрейм под характеристики двух моделей на тест Б-П
GQ_test <- data.frame(Model = names(models.list),
                                       Statistic = rep(0, length(models.list)),
                                       P.value = rep(0, length(models.list)))
for(i in 1:length(models.list)){
    GQ_test[i, 'Statistic'] <-                    
    round(gqtest(models.list[[i]], order.by = X4, data = h, fraction = 0.2)$statistic, 3)
    GQ_test[i, 'P.value'] <-                    
    round(gqtest(models.list[[i]], order.by = X4, data = h, fraction = 0.2)$p.value, 3)
}
#Таблица с нужными нам характеристиками
kable(GQ_test)
```

## Вывод
Для обеех моделей нулевая гипотеза отвергается, т.е. остатки являются гетероскедостичными, так как p-значения моделей (0.000 и 0.000 соответсвенно) меньше заданного уровня значимости 0.05.  

## Тест Дабрина-Уотсона на автокрреляцию
``` {r, echo=FALSE}
DW_test <- data.frame(Model = names(models.list),
                                       Statistic = rep(0, length(models.list)),
                                       P.value = rep(0, length(models.list)))
for(i in 1:length(models.list)){
    DW_test[i, 'Statistic'] <-                    
    round(dwtest(models.list[[i]], alternative = 'two.sided')$statistic, 3)
    DW_test[i, 'P.value'] <-                    
    round(dwtest(models.list[[i]], alternative = 'two.sided')$p.value, 3)
}
#Таблица с нужными нам характеристиками
kable(DW_test)
```

## Вывод
Для обеих моделей нулевая гипотеза принимается, т.е. коэффициент автокорреляции незначим, так как p-значения моделей (0,293 и 0,186 соответственно) больше заданного уровня значимости 0,05.

Так как условия Гаусса-Маркова не выполнены ни для одной модели, то возьмём лучшее уравнение регрессии fit.X4.fo (скорр. R-квадрат = 0,852) и переоценим его параметры с учётом ошибок спецификации.

``` {r, echo=FALSE, include=FALSE}
#
coeftest(models.list[[2]])

# Переоценка коэффициентов регрессии
coeftest(models.list[[2]], vcov. = vcovHAC(models.list[[2]]))
```

## Тест на равенство среднего остатков нулю для переоценённой модели
``` {r, echo=FALSE}
#Создаем фрейм под характеристики двух моделей на тест на среднего остатков нулю
mu.st <- round(t.test(models.list[[2]]$residuals, mu = 0, alternative = 'two.sided')$statistic, 3)
mu.pv<- round(t.test(models.list[[2]]$residuals, mu = 0, alternative = 'two.sided')$p.value, 3)
MU_test <- rbind(mu.st, mu.pv)
row.names(MU_test)<- c('Statistic','P-value')
# Вывод результатов в виде таблицы
kable(MU_test)
```



## Тест Бройша-Пагана на гетероскедастичность для переоценённой модели
``` {r, echo=FALSE}

    BP_test <- data.frame(Model = names(models.list)[2],
                                Statistic = 0,
                                P.value = 0)
    BP_test['Statistic'] <- 
        round(bptest(models.list[[2]])$statistic, 3)
    BP_test['P.value'] <- 
        round(bptest(models.list[[2]])$p.value, 3)

# Вывод результатов в виде таблицы
kable(BP_test)
```

## Тест Голдфельда-Квандта на гетероскедастичность для переоцененной 
``` {r, echo=FALSE}
#Создаем фрейм под характеристики двух моделей на тест Г-К
gq.st <- round(gqtest(models.list[[2]], order.by = X4, data = h, fraction = 0.2)$statistic, 3)
gq.pv<- round(gqtest(models.list[[2]], order.by = X4, data = h, fraction = 0.2)$p.value, 3)
GQ_test <- rbind(gq.st, gq.pv)
row.names(GQ_test)<- c('Statistic','P.value')
# Вывод результатов в виде таблицы
kable(GQ_test)
```

## Тест Дабрина-Уотсона на автокорреляцию
``` {r, echo=FALSE}
#Создаем фрейм под характеристики двух моделей на тест Д-У
dw.st <- round(dwtest(models.list[[2]], alternative = 'two.sided')$statistic, 3)
dw.pv<- round(dwtest(models.list[[2]], alternative = 'two.sided')$p.value, 3)
DW_test <- rbind(dw.st, dw.pv)
row.names(DW_test)<- c('Statistic','P.value')
# Вывод результатов в виде таблицы
kable(DW_test)
```

## Вывод
Несмоторя на переоценку коэффициентов для лучшей модели регрессии  услови Гаусса-Маркова не выполнены (по тестам Бройша-Пагана и Голдфельда-Квандта).