---
title: "Лабораторная Работа №1"
author: "Марковский Валентин Александрович"
date: "25 12 2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

``` {r, echo=FALSE, include = FALSE}
library('Hmisc')         # Пакет для расчёта корреляционной матрицы
library('corrplot')      # Пакет для визуализации корреляционной матрицы
library('knitr')         # Пакет для генерации отчёта
library('nortest')       # Тест Андерсона
DF <- read.table('R_Dannye_Markovskiy.csv',
                 header = T,       # Pаголовок в первой строке                  
                 dec = ',',        # Разделитель целой и дробной части                  
                 sep = ';',        # Разделитель значений в строке                  
                 row.names = 2,    # Первый столбец – названия наблюдений                  
                 as.is = T,              # Отсутствие факторов                  
                 na.strings = 'NA')      # Символы пропущенных значений 
reg.df <- DF[, 3:7]           #Записываем только переменные
reg.df <- na.omit(reg.df)     #Очищаем данные от пропущенных значений
```

## Список столбцов файла:
* ```fo``` - название федерального округа
* ```iso_code``` - код региона субъекта РФ
* ```region``` - название субъекта РФ
* ```Y``` - Объем отгруженных товаров собственного производства, выполненных работ и услуг собственными силами по видам экономической деятельности: обрабатывающие производства за 2014 год
* ```X1``` - Индексы цен производителей промышленных товаров по видам экономической деятельности: обрабатывающие производства за 2014 год
* ```X2``` - Изменение среднегодовой численности занятых за 2014 год
* ```X3``` - Индекс физического объема ВРП за 2013 год
* ```X4``` - Сумма убытка организаций по отдельным видам экономической деятельности: обрабатывающие производства за 2013 год

Данные по пяти показателям по обрабатывающим производствам за 2013-2014 гг. по регионам РФ. Данные собраны из файлов, загруженных из базы Росстата [https://www.gks.ru/folder/210/document/13204](https://www.gks.ru/folder/210/document/13204) 25 декабря 2020 года.
После загрузки файлы, каждый за отдельный год, были объединены в одну таблицу. Пропущенные наблюдения обозначить как NA.

### Раздел 1

## Построение гистограммы распределения с наложенными теоретическими кривыми плотности нормального закона.
```{r, echo = FALSE}
#Функция построения фактической и теоретической плотностей распределения
par(mfrow = c(2,3))
for(i in 1:5){
  x <- reg.df[, i]
   plot(density(x), col = 'red', main = colnames(reg.df)[i], xlab = colnames(reg.df)[i])    #Построение гистограммы
  curve(dnorm(x, mean = mean(x), sd = sd(x)),        #Теоретическая плотность логнормального закона
  col = "darkblue", lwd = 2, add = T)
}
```

## Тест Андерсона-Дарлинга на нормальность
```{r, echo = FALSE}
# Тест Андерсона-Дарлинга на нормальность распределения 
prov.norm.st <- apply(reg.df, 2, function(x){round(ad.test(x)$statistic,3)}) 
prov.norm.pv<- apply(reg.df, 2, function(x){round(ad.test(x)$p.value,3)})
prov.norm <- rbind(prov.norm.st,prov.norm.pv)
row.names(prov.norm)<- c('Cтатистика','P-значение')
# Вывод результатов в виде таблицы
kable(prov.norm)
```

## Вывод по тесту Андерсона-Дарлинга
Судя по полученным результатам, все переменные не имеют нормальный закон распределения, так как p-value меньше заданного уровня значимости, в нашем случае 0,05

## Точечные графики взаимного разброса
```{r, echo = FALSE}
#Графики взаимного разброса
pairs(reg.df, cex = 1, col = 'grey')
```

## Графическое представление корреляционной матрицы
```{r, include = FALSE}
# Матрица корреляций
# Сохраняем корреляционную матрицу 
matrix.cor <- cor(reg.df) 
# Сохраняем p-значения 
matrix.p <- rcorr(as.matrix(reg.df))$P 
```
```{r, echo=FALSE}
# Изображаем матрицу графически 
corrplot(matrix.cor,        # Корреляционная матрица
         method = "ellipse",      # Показать штриховкой
         order = "original",# Порядок отображения показателей
         diag = F,          # Отображение элементов на диагонали
         p.mat = matrix.p,  # Матрица p-значений
         insig = 'blank',   # Метод отображения незначимых
         sig.level = 0.1,   # Уровень значимости
         tl.pos = "tp")
```

## Вывод
Судя по графику можно сказать, что существует средняя линейная свясь между X2 и X3, также слабая линейная связть между X1 и X2, X2 и X4. Остальные экзогенные переменные не коррелируют.

### Раздел 2

```{r, echo = FALSE}
reg.df.log <- reg.df

reg.df.log$Y <- log(reg.df$Y)
reg.df.log$X1 <- log(reg.df$X1)
reg.df.log$X2 <- log(reg.df$X2)
reg.df.log$X3 <- log(reg.df$X3)
reg.df.log$X4 <- log(reg.df$X4)
```

## Построение гистограммы распределения с наложенными теоретическими кривыми плотности нормального закона.
```{r, echo = FALSE}
#Функция построения фактической и теоретической плотностей распределения
par(mfrow = c(2,3))
for(i in 1:5){
  x <- reg.df.log[, i]
   plot(density(x), col = 'red', main = colnames(reg.df.log)[i], xlab = colnames(reg.df.log)[i])    #Построение гистограммы
  curve(dnorm(x, mean = mean(x), sd = sd(x)),        #Теоретическая плотность логнормального закона
  col = "darkblue", lwd = 2, add = T)
}
```

## Тест Андерсона-Дарлинга на нормальность
```{r, echo = FALSE}
# Тест Андерсона-Дарлинга на нормальность распределения 
prov.norm.st <- apply(reg.df.log, 2, function(x){round(ad.test(x)$statistic,3)}) 
prov.norm.pv<- apply(reg.df.log, 2, function(x){round(ad.test(x)$p.value,3)})
prov.norm <- rbind(prov.norm.st,prov.norm.pv)
row.names(prov.norm)<- c('Cтатистика','P-значение')
# Вывод результатов в виде таблицы
kable(prov.norm)
```

## Вывод по тесту Андерсона-Дарлинга
По полученным данным делаем следующий вывод, что Y имеет нормальный закон распределения, так как p-значение больше заданного уровня значимости (0,05), остальные переменные (X1, X2, X3, X4) не имеют нормальный закон распределения.

## Точечные графики взаимного разброса
```{r, echo = FALSE}
#Графики взаимного разброса
pairs(reg.df.log, cex = 1, col = 'grey')
```

## Графическое представление корреляционной матрицы
```{r, include = FALSE}
# Матрица корреляций
# Сохраняем корреляционную матрицу 
matrix.cor <- cor(reg.df.log) 
# Сохраняем p-значения 
matrix.p <- rcorr(as.matrix(reg.df.log))$P 
```
```{r, echo=FALSE}
# Изображаем матрицу графически 
corrplot(matrix.cor,        # Корреляционная матрица
         method = "ellipse",      # Показать штриховкой
         order = "original",# Порядок отображения показателей
         diag = F,          # Отображение элементов на диагонали
         p.mat = matrix.p,  # Матрица p-значений
         insig = 'blank',   # Метод отображения незначимых
         sig.level = 0.1,   # Уровень значимости
         tl.pos = "tp")
```

## Вывод
Судя по графику можно сказать, что существует средняя линейная свясь между X2 и X3, также слабая линейная связть между Y и X1, Y и X4, X1 и X2. Остальные экзогенные переменные не коррелируют.